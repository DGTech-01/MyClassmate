@{
    ViewBag.Title = "Visitor";
    Layout = "~/Views/Shared/_FrontendLayout.cshtml";
}

<div class="container">
    <div class="row custom-css-step-one" id="StepOne">
        <div class="col-lg-6 p-0">
            <div style="margin: 10px;">
                <h2 class="form-title">JNCH Visitor Details</h2>

                <input name="_token" type="hidden" value="VcGOcMJ2fIAns2gC8TTcdIikBFSkONFJwB5jW08B">
                <div class="save">
                    <div class="visitor" id="visitor">
                        <div class="row">
                            <div class="col-md-6 col-sm-12" style="display:none">
                                <div class="form-group">
                                    <label class="label-css" for="first_name">Visitor's ID'<span class="text-danger">*</span></label>
                                    <input type="text" id="visitorID" class="form-control input-css " value="" placeholder="NEW" readonly>

                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="label-css" for="first_name">First Name <span class="text-danger">*</span></label>
                                    <input type="text" name="first_name" id="first_name" class="form-control input-css " value="" placeholder="e.g. xyz">

                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="label-css" for="">Last Name <span class="text-danger">*</span></label>
                                    <input type="text" name="last_name" id="last_name" class="form-control input-css " value="" placeholder="e.g. xyz">
                                </div>
                            </div>
                        </div>

                        <div class="row">

                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="label-css" for="">E-mail</label>
                                    <input type="email" name="email" id="email" class="form-control input-css " onchange="EmailValid()" placeholder="e.g. xyz@mail.com" required>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="label-css" for="">Phone <span class="text-danger">*</span><span class="text-info"> (Without Country Code,Without + sign)</span></label>
                                    <input type="number" name="phone" maxlength="10" id="phone" class="form-control input-css" placeholder="e.g. 910000000000">

                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group ">
                                    <label class="label-css" for="gender">Gender</label>
                                    <select id="gender" name="gender" class="form-control input-css ">
                                        <option value="">--Select Gender--</option>
                                        <option value="1">
                                            Male
                                        </option>
                                        <option value="2">
                                            Female
                                        </option>
                                        <option value="3">
                                            Other
                                        </option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="label-css" for="national_identification_no">Aadhar No <span class="text-danger">*</span></label>
                                    <input type="number" maxlength="12" name="national_identification_no" id="aadhar" class="form-control input-css " placeholder="e.g. 111122223333" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">

                            <div class="col-md-6 col-sm-12">
                                <div class="form-group ">
                                    <label class="label-css" for="department">Department</label>
                                    @Html.DropDownList("department", (IEnumerable<SelectListItem>)ViewBag.Department, null, new { @class = "form-control", @id = "department", @onchange = "OfficersName()" })

                                </div>
                            </div>

                            <div class="col-md-6 col-sm-12">
                                <div class="form-group ">
                                    <label class="label-css" for="gender">Officer</label>
                                    <select id="officer" class="form-control">
                                        <option value="">-- Select --</option>
                                    </select>
                                    @*@Html.DropDownList("officer", (IEnumerable<SelectListItem>)ViewBag.Officer, null, new { @class = "form-control", @id = "officer" })*@
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group ">
                                    <label class="label-css" for="gender">Visitor Type</label>
                                    @Html.DropDownList("visitorType", (IEnumerable<SelectListItem>)ViewBag.VisitorType, null, new { @class = "form-control", @id = "visitorType" })
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                                <div class="form-group ">
                                    <label class="label-css" for="gender">Document Type</label>
                                    @Html.DropDownList("documentType", (IEnumerable<SelectListItem>)ViewBag.DocumentType, null, new { @class = "form-control", @id = "documentType" })
                                </div>
                            </div>

                            <div class="col-md-12 col-sm-12">
                                <label for="customFile">Document</label>
                                <input type="file" id="Document" name="Document" accept="" class="form-control">


                            </div>
                            <div class="col-md-12 col-sm-12">
                                <div class="form-group">
                                    <label class="label-css" for="company_name">Company Name</label>
                                    <input type="text" name="company_name" id="company_name" class="form-control input-css " value="" placeholder="e.g. xyz">
                                </div>
                            </div>

                        </div>
                        <div class="row">

                            <div class="col-md-6 col-sm-12">
                                <div class="form-group ">
                                    <label class="label-css" for="purpose">Purpose <span class="text-danger">*</span></label>
                                    <textarea name="purpose" class="summernote-simple form-control height-textarea " id="purpose" placeholder="Write here..."></textarea>
                                </div>
                            </div>

                            <div class="col-md-6 col-sm-12">
                                <div class="form-group ">
                                    <label class="label-css" for="address">Address</label>
                                    <textarea name="address" class="summernote-simple form-control height-textarea " id="address" placeholder="e.g. xyz"></textarea>
                                </div>
                            </div>

                            @*<input type="number" id="tokenno" value="@ViewBag.TokenNo" style="visibility:hidden" />*@


                        </div>
                        <div class="row mt-3">
                            <div class="col-6">
                                <a href="@Url.Action("Index", "Home")" class="btn cancel-btn float-left">
                                    <span class="">Cancel</span>
                                </a>
                            </div>
                            <div class="col-6">
                                <button type="submit" class="btn continue-btn float-right btn-submit-one" id="nexttbn" onclick="myFunction()">
                                    Continue
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="col-lg-6 image-display d-flex justify-content-end ">
            <img class="img-css" src="https://demo.quickpass.xyz/frontend/images/vps.png" alt="">
        </div>
    </div>



    <div class="card border-0 bg-body" id="StepTwo" style="display:none;">


        <input type="hidden" name="_token" value="Q7hXgdIgg3KrSSnijAsnernaMgiVma8VFPXRIcLw">
        <div class="card-body custom-camera">
            <div class="row">
                <div class="col-md-6 left-div">
                    <div class="card border-0 ">
                        <h4 style="color: #111570;font-weight: bold" class="text-center">Take Visitor Photo</h4>

                        <div class="card-body">
                            <div class="video-options mb-4">
                                <select name="" id="" class="custom-select">
                                    <option value="">Select camera</option>
                                </select>
                            </div>
                            <div class="row">
                                <div class="col-9">
                                    <video id="videos" autoplay style="width:270px; height: 200px; "></video>
                                    <canvas class="d-none" style="border:5px solid #d3d3d3; display: none"></canvas>
                                    <input type="hidden" name="photo" value="">
                                </div>
                                <div class="col-3">
                                    <button type="button" id="screenshot" title="ScreenShot" class='retakephoto'>
                                        <img class="img" src="https://demo.quickpass.xyz/images/capture.png" style="height: auto; margin-top: 9px;">
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                    <span class="text-center"></span>
                </div>

                <div class="col-md-6 ">
                    <div class="img-cards" id="printidcard">
                        <div class="id-card-holder">
                            <div class="id-card custom-id-card">
                                <div class="id-card-photo">
                                    <img id="image" style="width: 120px;height: 120px;" class="screenshot-image" alt="">

                                </div>
                                <h2 class="name mt-4"> <span id="displayNameInfo"> </span></h2>
                                <h2 class="info"> Phone : <span id="phoneInfo"> </span></h2>
                                <h2 class="info">Email :  <span id="emailInfo"> </span></h2>

                                <h2 class="visit mt-4">VISITED TO</h2>
                                <h3 class="email">Officer:  <span id="officerInfo"> </span></h3>
                                <hr class="bar">
                                <p class="company">Jawaharlal Nehru</p>
                                <p class="company">Custom House</p>
                                @*<p class="email">E-mail :info@inilabs.xyz </p>*@
                            </div>
                        </div>

                    </div>

                </div>


            </div>

        </div>
        <div class="card-footer custom-footer">
            <div class="row">
                <div class="col-md-6">
                    <a href="#" onclick="GoBack();" class="btn btn-primary float-left text-white cancel px-5 py-2">
                        Back
                    </a>
                </div>
                <div class="col-md-6">
                    <a href="#" onclick="SaveImage();" class="btn btn-primary float-left text-white px-5 py-2" id="btnUpload">
                        Continue
                    </a>
                </div>
              
            </div>
        </div>
    </div>



</div>
<input id="TokenNo" type="hidden" />

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>


<script type="text/javascript">

   function OfficersName() {
        debugger

        var departmentId = document.getElementById('department').value;
       
        var element = {};
        element.departmentId = departmentId

        var data = JSON.stringify(element);
        $.ajax({
            data: data,
            type: "POST",
            cache: false,
            dataType: "json",
            contentType: "application/json, charset=utf-8",
            url: "/Visitor/GetOfficersByDepartment",
            success: function (data) {
                // Use the data returned by the controller action to populate the dropdown
                var dropdown = $('#officer');
                dropdown.empty();
                dropdown.append($('<option></option>').val('').text('--Select--'));
                $.each(data, function (index, item) {
                    console.log(data);
                    console.log("drodrf");
                    dropdown.append($('<option></option>').val(item.Value).text(item.Text));
                });
            }

        });
    }


    function myFunction() {
        var First_Name = document.getElementById("first_name").value;
        var Last_Name = document.getElementById("last_name").value;
        var Full_Name = First_Name + ' ' + Last_Name;
        var Phone = document.getElementById("phone").value;
        var Email = document.getElementById("email").value;
        var Officer =  $("#officer option:selected");

        document.getElementById('displayNameInfo').textContent = Full_Name;
        document.getElementById('phoneInfo').textContent = Phone;
        document.getElementById('emailInfo').textContent = Email;
        document.getElementById('officerInfo').textContent = Officer.text();

    SaveVisitors();
    }

    function GoBack() {
        $('#StepTwo').hide();
        $('#StepOne').show();
    }
</script>


<script>
$(document).ready(function () {
        $("#nexttbn").click(function () {
            var firstName = $("#first_name").val();
            var lastName = $("#last_name").val();
            var phoneNumber = $("#phone").val();
            var emailValue = $("#email").val();

            // Update the HTML content with the phone number
            $("#displayNameInfo").text(fistName + ' ' + lastName);
            $("#emailInfo").text(emailValue);
            $("#phoneInfo").text(phoneNumber);
        });

    });

function SaveVisitors() {
    if (isValid()) {
    debugger;
       

    var formdata = new FormData();
        var fileUpload1 = $("#Document").get(0);
                var files = fileUpload1.files;

                var formdata = new FormData();
                if ($('#Document')[0].files.length != 0) {

                    formdata.append(files[0].name, files[0]);
                }  
        formdata.append('ID', document.getElementById("visitorID").value);
        formdata.append('FirstName', document.getElementById("first_name").value);
        formdata.append('LastName', document.getElementById("last_name").value);
        formdata.append('CompanyName', document.getElementById("company_name").value);
        formdata.append('Gender', document.getElementById("gender").value);
        formdata.append('VisitorType', document.getElementById("visitorType").value);
        formdata.append('Department', document.getElementById("department").value);
        formdata.append('Officer', document.getElementById("officer").value);
        formdata.append('AadharNo', document.getElementById("aadhar").value);
        formdata.append('DocumentType', document.getElementById("documentType").value);
        formdata.append('VisitorAddress', document.getElementById("address").value);
        formdata.append('VisitPurpose', document.getElementById("purpose").value);
        formdata.append('Phone', document.getElementById("phone").value);
        formdata.append('Email', document.getElementById("email").value);

        return $.ajax({
            url: "/Visitor/AddVisitorDetail",
            type: 'POST',
            data: formdata,
            async: false,
            contentType: false,
            processData: false,
            success: function (result) {
                if (result.Message === 'SUCCESS') {
                    var token = result.TokenNo;
                    $("#TokenNo").val(token);
                    $('#StepTwo').show();
                    $('#StepOne').hide();
                    //Swal.fire({
                    //    text: 'Visitores Data Saved Successfully',
                    //    icon: 'success',
                    //    showCancelButton: true,
                    //}).then((result) => {
                    //   if (result.isConfirmed) {
                      //       $('#StepTwo').show();
                        //     $('#StepOne').hide();
                            //navigateURL('/CheckIn/Visitor/');
                       // }
                   // });

                } else {
                    alert("Save failed!");
                }
            },
            error: function () {
                alert("Error!");
            }
        });
    }
}


function navigateURL(url) {
    // Implement your navigation logic here
    window.location.href = url;
}

    function SaveImage() {

        var file = document.getElementById("image").src;


        var TokenNo = document.getElementById("TokenNo").value;


        var formdata = new FormData();
        formdata.append("image", file);
        formdata.append('TokenNo', TokenNo);

        $.ajax({
            url: "/Visitor/SaveImage",
            type: 'POST',
            data: formdata,
            async: false,
            contentType: false,
            processData: false,
            success: function (result) {
                if (JSON.stringify(result > 0)) {       
                var TokenNo = document.getElementById("TokenNo").value;
                window.location = '/CheckIn/ShowCheckIn/?token=' + TokenNo;
                
                }

            },

        });

    }

    function isValid() {

        var Id = $("#visitorID").val();
        var FirstName = $("#first_name").val();
        var LastName = $("#last_name").val();
        var Officer = $("#officer_name").val();
        var Phone = $("#phone").val();
        var Email = $("#email").val();
        var Gender = $("#gender").val();
        var CompanyName = $("#company_name").val();
        var AadharNo = $("#aadhar").val();
        var Purpose = $("#purpose").val();
        var Address = $("#address").val();
        //var Image = $("image").val();


        var blResult = Boolean;
        blResult = true;


        if (FirstName == "") {
            document.getElementById('first_name').style.borderColor = "red"
            blResult = blResult && false;
        }
        if (LastName == "") {
            document.getElementById('last_name').style.borderColor = "red"
            blResult = blResult && false;
        }
        if (Officer == "") {
            document.getElementById('officer_name').style.borderColor = "red"
            blResult = blResult && false;
        }
        if (Phone == "") {
            document.getElementById('phone').style.borderColor = "red"
            blResult = blResult && false;
        }
        if (Email == "") {
            document.getElementById('email').style.borderColor = "red"
            blResult = blResult && false;
        }

        if (Gender == "") {
            document.getElementById('gender').style.borderColor = "red"
            blResult = blResult && false;
        }

        if (CompanyName == "") {
            document.getElementById('company_name').style.borderColor = "red"
            blResult = blResult && false;
        }

        if (AadharNo == "") {
            document.getElementById('aadhar').style.borderColor = "red"
            blResult = blResult && false;
        }

        if (Purpose == "") {
            document.getElementById('purpose').style.borderColor = "red"
            blResult = blResult && false;
        }

        if (Address == "") {
            document.getElementById('address').style.borderColor = "red"
            blResult = blResult && false;
        }


        if (blResult == false) { alert('Please fill the required fields!'); }
        return blResult;
    }



    function EmailValid() {

    var Email = $("#email").val();


    var data1 = { 'Email': Email };
    var data = JSON.stringify(data1);

    $.ajax({
        data: data,
        type: "POST",
        contentType: "application/json; charset=utf-8",
        url: "/Visitor/EmailValidation",
        success: function (message) {
            if (message == 'SUCCESS') {


            } else {
                alert("Email is already Used!");
            }
        }
    });
}
</script>
